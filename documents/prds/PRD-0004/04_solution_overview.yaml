prd_solution_overview:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  proposed_solution:
    overview: 'The Work Substrate extends the APM2 kernel (PRD-0001) to internalize the full work lifecycle. Plans, changesets, reviews, findings, and evidence become first-class typed objects in the ledger with deterministic projections. Agents interact via stable internal APIs; GitHub becomes a sync adapter that projects internal state to external PRs/issues. The system provides bounded refinement passes for PRD creation, internal gates for review, finding normalization for recurrence detection, and automatic countermeasure work creation. The north-star behavior is that agents operate entirely through internal interfaces, producing auditable event trails, while external forge compatibility is maintained through projection adapters.'
    key_components:
      - 'Work Domain Module: Core types (Plan, ChangeSet, Finding, Evidence) with spec canonicalization, hashing, and event emission APIs.'
      - 'WorkReducer: Deterministic projection of work state from ledger events, maintaining plan status, gate readiness, and traceability closure indexes.'
      - 'FindingSignature: Deterministic normalization of findings into clusterable signatures for recurrence detection.'
      - 'RecurrenceReducer: Projection tracking finding recurrence by signature with threshold-triggered countermeasure work creation.'
      - 'Gate System: Gate trait with AAT, security, and code quality implementations executing as bounded holonic episodes.'
      - 'GateRunner: Orchestrator that runs gates against changesets, emitting GateRunStarted/Completed events and evidence bundles.'
      - 'Plan Refinement Holon: Supervising holon that coordinates multi-pass PRD refinement (scope, criteria, constraints, coherence) with deterministic stop conditions.'
      - 'GitHub Sync Adapter: Projects ledger state to GitHub PRs/issues; preserves compatibility while internal ledger is authoritative.'
      - 'Operator Console: CLI commands for audit (timeline, why), stats (findings, gates), and intervention (freeze, override).'
    external_dependencies:
      - 'APM2 Kernel (PRD-0001): Ledger, reducers, process management, crypto, holonic execution primitives.'
      - 'GitHub (sync target): Current source control; becomes projection target, not source of truth.'
      - 'LLM adapters: Claude CLI, Gemini CLI for refinement passes; invoked via kernel ProcessRunner.'
  interfaces:
    external_apis:
      - 'GitHub API: Accessed only via GitHub sync adapter for projection; never called directly by agents.'
      - 'LLM CLI adapters: Claude/Gemini invoked via ProcessRunner with credential sourcing and log redaction.'
    user_surfaces:
      - 'CLI plan commands: plan new, plan refine, plan validate, plan status.'
      - 'CLI gate commands: gate run, gate status.'
      - 'CLI audit commands: audit timeline, audit why.'
      - 'CLI stats commands: stats findings, stats gates, stats countermeasures.'
      - 'CLI intervention commands: intervene freeze, intervene override, intervene unfreeze.'
      - 'CLI countermeasure commands: countermeasure propose, countermeasure list, countermeasure verify.'
