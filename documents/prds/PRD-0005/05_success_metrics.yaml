prd_success_metrics:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  metrics:
    - id: MET-0001
      name: End-to-end compile success rate
      description: Percentage of compile runs that complete without lint violations for a fixed repo state.
      target: ">= 90%"
      measurement:
        method: "CI harness runs on PRDs tagged IDEA_COMPILER"
        signal_source: "run manifests + exit codes"

    - id: MET-0002
      name: Requirement mapping completeness
      description: |
        Percentage of PRD requirements mapped to existing components or explicitly adjudicated as net-new substrate.
        Quality gates: no component mapped to >30% of requirements (prevents trivial mappings);
        net-new substrate ratio <=20% (prevents classification inflation).
      target: "100% completeness with quality gates"
      measurement:
        method: "Impact Map coverage check with distribution analysis"
        signal_source: "impact_map artifacts"

    - id: MET-0003
      name: Ticket noise index
      description: |
        Proxy measure for ticket usefulness and non-duplication:
        (tickets without file paths or verification commands) / total tickets.
      target: "<= 10%"
      measurement:
        method: "ticket lint"
        signal_source: "documents/work/tickets"

    - id: MET-0004
      name: Reuse ratio
      description: |
        Ratio of tickets that primarily extend existing modules vs introduce net-new modules/crates.
        Baseline (pre-compiler) to be measured during implementation. Target of 80% represents
        estimated 2x improvement over baseline. If baseline is already >70%, target should be revised upward.
      target: ">= 80% extend-existing"
      measurement:
        method: "diff classifier + RFC justification scan"
        signal_source: "RFC + ticket outputs"

    - id: MET-0005
      name: Determinism and diff stability
      description: Re-running compilation with identical inputs and profile yields byte-identical artifacts, or a bounded diff requiring acceptance.
      target: ">= 95% byte-identical"
      measurement:
        method: "golden run harness"
        signal_source: "artifact hashes"

    - id: MET-0006
      name: Compile latency
      description: |
        Wall-clock time for `apm2 factory compile` on a typical developer machine.
        Baseline: repo with <=50 crates, <=500 KLOC, machine with >=4 cores, >=8GB RAM, SSD storage.
        For larger repos, latency scales approximately linearly with crate count.
      target: "p50 <= 2 minutes, p95 <= 5 minutes"
      measurement:
        method: "timings recorded in run manifests"
        signal_source: "run manifests"

    - id: MET-0007
      name: Continuous refactor throughput
      description: Number of refactor radar tickets completed per time window and their measured effect on duplication/hotspot signals.
      target: "weekly radar + measurable improvement trend"
      measurement:
        method: "radar signature tracking"
        signal_source: "radar artifacts + recurrence projection"
