rfc_rollout_and_ops:
  schema_version: "2026-01-24"
  template_version: "2026-01-24"
  rollout_plan:
    phases:
    - id: ROL-3001
      name: "Core Types and Traits"
      description: |
        Implement the foundational types and traits for the holonic framework.
        This phase establishes the contract surface without full integration.
      steps:
      - "Define Holon trait with associated types"
      - "Implement WorkObject and WorkLifecycle"
      - "Implement Lease and Budget types"
      - "Implement LedgerEvent types"
      - "Write unit tests for all types"
      - "Document trait usage patterns"
      guardrails:
      - "All public types must have documentation"
      - "Unit test coverage > 90% for type modules"
      - "No unsafe Rust without explicit justification"
      rollback_steps:
      - "Revert to previous commit"
      - "Types are not yet integrated; no runtime impact"
      evidence_ids:
      - EVID-3001
      - EVID-3003
      - EVID-3004
      exit_criteria:
      - "Holon trait compiles and is implementable"
      - "WorkObject can transition through all lifecycle states"
      - "Lease expiration and budget tracking work correctly"
      - "All unit tests pass"

    - id: ROL-3002
      name: "Episode Controller Implementation"
      description: |
        Implement the episode controller that manages bounded execution contexts
        and evaluates stop conditions. This is the core execution engine.
      steps:
      - "Implement EpisodeContext construction"
      - "Implement stop condition evaluation"
      - "Implement budget tracking per episode"
      - "Integrate with ledger for event emission"
      - "Write integration tests with mock holons"
      guardrails:
      - "Budget enforcement must be deterministic"
      - "Stop conditions must terminate"
      - "All episodes must emit ledger events"
      rollback_steps:
      - "Disable episode controller"
      - "Fall back to synchronous execution"
      evidence_ids:
      - EVID-3002
      exit_criteria:
      - "Episodes execute within budget"
      - "Stop conditions correctly terminate execution"
      - "Ledger events recorded for all episodes"
      - "Integration tests pass"

    - id: ROL-3003
      name: "Holon Spawning and Coordination"
      description: |
        Implement the spawn_holon orchestration function that creates sub-holons
        with derived leases and manages their lifecycle.
      steps:
      - "Implement lease derivation for sub-holons"
      - "Implement spawn_holon function"
      - "Implement escalation handling"
      - "Implement work completion flow"
      - "Write coordination tests"
      guardrails:
      - "Sub-holon leases must not exceed parent scope"
      - "Escalation must always be possible"
      - "Work completion must emit evidence"
      rollback_steps:
      - "Disable sub-holon spawning"
      - "Run all work in single holon"
      evidence_ids:
      - EVID-3001
      - EVID-3004
      exit_criteria:
      - "Sub-holons can be spawned with derived leases"
      - "Escalation propagates to supervisor"
      - "Work completion flow generates evidence"
      - "Coordination tests pass"

    - id: ROL-3004
      name: "Skill Integration Pattern"
      description: |
        Extend skill frontmatter to support holon configuration and integrate
        skills as holon instantiation templates.
      steps:
      - "Define holon: field schema for skill frontmatter"
      - "Implement skill-to-holon instantiation"
      - "Create example-holon skill"
      - "Update documentation"
      guardrails:
      - "Existing skills must continue to work"
      - "holon: field is optional for backward compatibility"
      rollback_steps:
      - "Remove holon: field from frontmatter schema"
      - "Skills revert to non-holonic execution"
      evidence_ids:
      - EVID-3001
      exit_criteria:
      - "Skills can declare holon configuration"
      - "Skills instantiate as holons when configured"
      - "Example-holon skill demonstrates full pattern"
      - "Documentation complete"

  operability:
    runbooks:
    - id: RUN-3001
      name: "Lease Exhaustion Recovery"
      trigger: "Holon lease expired or budget exhausted during work"
      steps:
      - "Check ledger for last successful episode"
      - "Identify cause of budget exhaustion"
      - "If temporary: issue new lease and resume"
      - "If systematic: escalate to supervisor for replan"
      - "Update budget defaults if pattern detected"
      evidence_ids:
      - EVID-3004
    - id: RUN-3002
      name: "Work Stuck in Blocked State"
      trigger: "Work remains Blocked for > configured threshold"
      steps:
      - "Inspect BlockedReason from work object"
      - "Check if blocking dependency can be resolved"
      - "If resolvable: trigger resolution and resume"
      - "If not resolvable: escalate to human adjudication"
      - "Consider work abort if escalation times out"
      evidence_ids:
      - EVID-3003
    - id: RUN-3003
      name: "Episode Loop Divergence"
      trigger: "Episode count exceeds max_episodes without progress"
      steps:
      - "Review episode results for progress pattern"
      - "Check if goal specification is achievable"
      - "If stuck: trigger escalation with context"
      - "Consider reducing goal scope or adding constraints"
      - "Document divergence pattern for future prevention"
      evidence_ids:
      - EVID-3002
    alarms:
    - id: ALM-3001
      name: "High lease expiration rate"
      condition: "lease_expired_count > 5 per hour"
      severity: WARNING
      response: "Review budget defaults; may need increase"
    - id: ALM-3002
      name: "Escalation rate elevated"
      condition: "escalation_count > 3 per hour per skill"
      severity: WARNING
      response: "Review skill goals and constraints"
    - id: ALM-3003
      name: "Work stuck in Blocked"
      condition: "blocked_duration > 1 hour"
      severity: WARNING
      response: "Investigate blocking dependency"
    automated_response_notes:
    - "Lease expiration triggers automatic escalation to supervisor"
    - "Budget exhaustion terminates episode and triggers stop condition"
    - "Stuck work is automatically escalated after configured timeout"

  observability:
    metrics:
    - name: "holon_episode_count"
      type: COUNTER
      description: "Total episodes executed"
      labels: ["holon_type", "outcome"]
    - name: "holon_episode_duration_seconds"
      type: HISTOGRAM
      description: "Episode execution duration"
      labels: ["holon_type"]
    - name: "holon_budget_consumed"
      type: COUNTER
      description: "Budget resources consumed"
      labels: ["holon_type", "resource_type"]
    - name: "work_lifecycle_transitions"
      type: COUNTER
      description: "Work state transitions"
      labels: ["from_state", "to_state"]
    - name: "lease_active_count"
      type: GAUGE
      description: "Currently active leases"
      labels: ["holon_type"]
    - name: "escalation_total"
      type: COUNTER
      description: "Total escalations"
      labels: ["holon_type", "reason"]
    logs:
    - name: "holon_events"
      format: "JSON structured logs via tracing"
      retention: "30 days"
      classification: INTERNAL
    - name: "episode_transcripts"
      format: "Episode context and results"
      retention: "90 days"
      classification: INTERNAL
    traces:
    - name: "work_trace"
      description: "End-to-end trace of work execution"
      span_names:
      - "work_intake"
      - "lease_issued"
      - "episode_execute"
      - "artifact_emit"
      - "work_complete"
    - name: "episode_trace"
      description: "Detailed trace within an episode"
      span_names:
      - "context_build"
      - "agent_invoke"
      - "tool_mediate"
      - "stop_evaluate"
    audit_events:
    - name: "LEASE.EXCEEDED"
      description: "Holon attempted action beyond lease scope"
      retention: "1 year"
      alerting: true
    - name: "WORK.STUCK"
      description: "Work blocked beyond threshold"
      retention: "1 year"
      alerting: true
    - name: "ESCALATION.TIMEOUT"
      description: "Escalation not handled within deadline"
      retention: "1 year"
      alerting: true
