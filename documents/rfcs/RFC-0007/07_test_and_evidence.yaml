rfc_test_and_evidence:
  schema_version: "2026-01-25"
  template_version: "2026-01-25"

  test_plan:
    unit: []
    # No unit tests required - this is configuration/documentation only

    integration:
    - id: IT-7001
      name: "Verify mold linker is used for builds"
      scope: "Build system uses mold linker"
      test_environment: "Local Linux with mold installed"
      deterministic: true
      setup: |
        1. Ensure mold is installed (which mold)
        2. Ensure .cargo/config.toml has mold configuration
      execution: "cargo build -vv 2>&1 | grep -E '(mold|fuse-ld=mold)'"
      validation:
        output_contains: "mold"
      pass_criteria: |
        Build output shows mold is being used as the linker.
        Run: cargo build -vv 2>&1 | grep mold
      evidence_ids:
      - EVID-7001

    - id: IT-7002
      name: "Verify builds still succeed with mold"
      scope: "Workspace builds correctly with mold linker"
      test_environment: "Local Linux with mold installed"
      deterministic: true
      setup: |
        1. Clean target directory: cargo clean
        2. Ensure mold configuration is in place
      execution: "cargo build --workspace"
      validation:
        exit_code: 0
      pass_criteria: |
        Full workspace build succeeds with mold linker.
        Run: cargo clean && cargo build --workspace
      evidence_ids:
      - EVID-7001

    - id: IT-7003
      name: "Verify tests pass with mold linker"
      scope: "All tests pass when built with mold"
      test_environment: "Local Linux with mold installed"
      deterministic: true
      setup: |
        1. Ensure mold configuration is in place
      execution: "cargo test --workspace"
      validation:
        exit_code: 0
      pass_criteria: |
        All tests pass when built with mold linker.
        Run: cargo test --workspace
      evidence_ids:
      - EVID-7001

    fuzz: []
    perf: []
    chaos: []

    manual_verification:
      note: |
        Manual verification confirms documentation accuracy and
        tool functionality.

      items:
      - id: MV-7001
        name: "Verify mold linker configuration"
        prerequisites:
        - "mold installed on system"
        - ".cargo/config.toml updated"
        steps:
        - "Run: cargo clean"
        - "Run: cargo build -vv 2>&1 | grep mold"
        - "Verify mold appears in output"
        pass_criteria:
          output_must_contain: "mold"
        fail_criteria:
        - "No mention of mold in build output"
        - "Build uses ld or gold instead"
        evidence_ids:
        - EVID-7001

      - id: MV-7002
        name: "Verify CONTRIBUTING.md sccache documentation"
        prerequisites:
        - "CONTRIBUTING.md updated with sccache section"
        steps:
        - "Read sccache section in CONTRIBUTING.md"
        - "Follow installation instructions"
        - "Follow configuration instructions"
        - "Verify sccache --show-stats works"
        pass_criteria:
          documentation_includes:
          - "cargo install sccache"
          - "export RUSTC_WRAPPER=sccache"
          - "Benefits for multi-worktree development"
        fail_criteria:
        - "Instructions are incomplete"
        - "Commands don't work as documented"
        evidence_ids:
        - EVID-7002

      - id: MV-7003
        name: "Verify CONTRIBUTING.md nextest documentation"
        prerequisites:
        - "CONTRIBUTING.md updated with nextest section"
        steps:
        - "Read nextest section in CONTRIBUTING.md"
        - "Follow installation instructions"
        - "Run cargo nextest run"
        pass_criteria:
          documentation_includes:
          - "cargo install cargo-nextest"
          - "cargo nextest run"
        fail_criteria:
        - "Instructions are incomplete"
        - "Commands don't work as documented"
        evidence_ids:
        - EVID-7003

      - id: MV-7004
        name: "Verify CONTRIBUTING.md CI vs local settings"
        prerequisites:
        - "CONTRIBUTING.md updated with build settings section"
        steps:
        - "Read build settings section"
        - "Verify shell snippet is present"
        - "Verify warning about CI settings"
        pass_criteria:
          documentation_includes:
          - "CARGO_INCREMENTAL"
          - "RUSTC_WRAPPER"
          - "Shell profile snippet"
          - "CI vs local explanation"
        fail_criteria:
        - "Missing explanation of CI settings"
        - "No shell snippet provided"
        evidence_ids:
        - EVID-7004

  evidence_bundle:
    root: "evidence/rfc/RFC-0007/"
    artifact_registry:
      mode: FILE_PER_ARTIFACT
      local_root: "evidence_artifacts/"
      local_artifacts:
      - artifact_id: EVID-7001
        artifact_ref: "evidence_artifacts/EVID-7001.yaml#rfc_evidence_artifact"
        description: "mold linker is configured and working"
        artifact_type: "command_output"
        verification:
          automated: "cargo build -vv 2>&1 | grep mold"
          manual: "MV-7001 passes with documented output"
        location: "evidence/RFC-0007/EVID-7001_mold_config.log"

      - artifact_id: EVID-7002
        artifact_ref: "evidence_artifacts/EVID-7002.yaml#rfc_evidence_artifact"
        description: "sccache documentation is accurate"
        artifact_type: "documentation_review"
        verification:
          manual: "MV-7002 passes with complete documentation"
        location: "evidence/RFC-0007/EVID-7002_sccache_docs.md"

      - artifact_id: EVID-7003
        artifact_ref: "evidence_artifacts/EVID-7003.yaml#rfc_evidence_artifact"
        description: "cargo-nextest documentation is accurate"
        artifact_type: "documentation_review"
        verification:
          manual: "MV-7003 passes with complete documentation"
        location: "evidence/RFC-0007/EVID-7003_nextest_docs.md"

      - artifact_id: EVID-7004
        artifact_ref: "evidence_artifacts/EVID-7004.yaml#rfc_evidence_artifact"
        description: "CI vs local settings documentation is accurate"
        artifact_type: "documentation_review"
        verification:
          manual: "MV-7004 passes with complete documentation"
        location: "evidence/RFC-0007/EVID-7004_settings_docs.md"

      imports: []

  requirement_evidence_map:
    note: |
      Mapping of requirements to their evidence artifacts:
      - PERF-001: EVID-7001 (mold linker verification)
      - PERF-002: EVID-7002 (sccache documentation review)
      - PERF-003: EVID-7003 (nextest documentation review)
      - PERF-004: EVID-7004 (CI vs local settings documentation)
      - PERF-005: EVID-7004 (shell profile snippet - same evidence as PERF-004)
