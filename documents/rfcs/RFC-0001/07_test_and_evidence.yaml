rfc_test_and_evidence:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  test_plan:
    unit:
    - id: UT-0001
      name: "Ledger storage unit tests"
      scope: "SQLite operations, append, read, cursor"
      coverage_target: ">90%"
      framework: "cargo test"
      evidence_ids:
      - EVID-0004
    - id: UT-0002
      name: "Event schema encoding tests"
      scope: "Protobuf encode/decode, canonical encoding"
      coverage_target: ">95%"
      framework: "cargo test"
      evidence_ids:
      - EVID-0008
    - id: UT-0003
      name: "Hash-chain and signature tests"
      scope: "Blake3 hashing, Ed25519 sign/verify"
      coverage_target: ">95%"
      framework: "cargo test"
      evidence_ids:
      - EVID-0004
    - id: UT-0004
      name: "Policy evaluation unit tests"
      scope: "Rule matching, default-deny, budgets"
      coverage_target: ">90%"
      framework: "cargo test"
      evidence_ids:
      - EVID-0003
    - id: UT-0005
      name: "Session state machine tests"
      scope: "State transitions, entropy tracking"
      coverage_target: ">90%"
      framework: "cargo test"
      evidence_ids:
      - EVID-0006
    - id: UT-0006
      name: "Lease registrar tests"
      scope: "Issue, renew, release, conflict detection"
      coverage_target: ">95%"
      framework: "cargo test"
      evidence_ids:
      - EVID-0006
    integration:
    - id: IT-0001
      name: "Supervisor integration test"
      scope: "Session lifecycle with real adapters"
      test_environment: "Local with mock agent"
      evidence_ids:
      - EVID-0001
    - id: IT-0002
      name: "Policy engine integration test"
      scope: "Full request/response flow with policy"
      test_environment: "Local with test policy"
      evidence_ids:
      - EVID-0003
    - id: IT-0003
      name: "Work protocol integration test"
      scope: "Work creation, lease, evidence, gate"
      test_environment: "Local with simulated work"
      evidence_ids:
      - EVID-0001
      - EVID-0016
    - id: IT-0004
      name: "E2E factory run test"
      scope: "Full spec-to-evidence workflow"
      test_environment: "Local with real agent"
      evidence_ids:
      - EVID-0001
    fuzz:
    - id: FZ-0001
      name: "Protobuf parsing fuzzing"
      scope: "ToolRequest, KernelEvent parsing"
      framework: "cargo-fuzz"
      corpus_seed: "proto/*.proto"
      evidence_ids:
      - EVID-0008
      - EVID-0014
    - id: FZ-0002
      name: "Policy evaluation fuzzing"
      scope: "Policy rule matching edge cases"
      framework: "cargo-fuzz"
      corpus_seed: "test_policies/*.yaml"
      evidence_ids:
      - EVID-0003
      - EVID-0014
    perf:
    - id: PF-0001
      name: "Ledger write throughput benchmark"
      scope: "Events per second under load"
      baseline: "TBD during implementation"
      target: ">1000 events/sec"
      evidence_ids:
      - EVID-0011
    - id: PF-0002
      name: "Policy evaluation latency benchmark"
      scope: "P99 latency for rule evaluation"
      baseline: "TBD during implementation"
      target: "<1ms P99"
      evidence_ids:
      - EVID-0011
    - id: PF-0003
      name: "Reducer replay benchmark"
      scope: "Time to replay 10k events"
      baseline: "TBD during implementation"
      target: "<10s for 10k events"
      evidence_ids:
      - EVID-0005
    chaos:
    - id: CH-0001
      name: "Session crash recovery test"
      scope: "Kill session mid-operation, verify recovery"
      injection: "SIGKILL to session process"
      expected_behavior: "Session restarts from ledger cursor"
      evidence_ids:
      - EVID-0006
    - id: CH-0002
      name: "Ledger corruption detection test"
      scope: "Inject byte flip in SQLite file"
      injection: "Modify random byte in events table"
      expected_behavior: "Hash chain verification fails, error reported"
      evidence_ids:
      - EVID-0004
    - id: CH-0003
      name: "Budget exhaustion test"
      scope: "Run agent until budget exceeded"
      injection: "Configure low budget, run demanding task"
      expected_behavior: "BudgetExceeded event, session terminated"
      evidence_ids:
      - EVID-0018

  evidence_bundle:
    root: "evidence/rfc/RFC-0001/"
    artifact_registry:
      mode: FILE_PER_ARTIFACT
      local_root: "evidence_artifacts/"
      local_artifacts:
      - artifact_id: EVID-1001
        artifact_ref: "evidence_artifacts/EVID-1001.yaml#rfc_evidence_artifact"
      - artifact_id: EVID-1002
        artifact_ref: "evidence_artifacts/EVID-1002.yaml#rfc_evidence_artifact"
      - artifact_id: EVID-1003
        artifact_ref: "evidence_artifacts/EVID-1003.yaml#rfc_evidence_artifact"
      - artifact_id: EVID-1004
        artifact_ref: "evidence_artifacts/EVID-1004.yaml#rfc_evidence_artifact"
      - artifact_id: EVID-1005
        artifact_ref: "evidence_artifacts/EVID-1005.yaml#rfc_evidence_artifact"
      - artifact_id: EVID-1006
        artifact_ref: "evidence_artifacts/EVID-1006.yaml#rfc_evidence_artifact"
      imports:
      - source_prd: PRD-0001
        imported_ids:
        - EVID-0001
        - EVID-0002
        - EVID-0003
        - EVID-0004
        - EVID-0005
        - EVID-0006
        - EVID-0007
        - EVID-0008
        - EVID-0010
        - EVID-0011
        - EVID-0012
        - EVID-0013
        - EVID-0014
        - EVID-0016
        - EVID-0017
        - EVID-0018
        - EVID-0019
        - EVID-0020
        - EVID-0021
